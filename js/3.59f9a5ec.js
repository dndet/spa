(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{"50a9":function(e,t,i){"use strict";i("6741")},"598e":function(e,t,i){},6741:function(e,t,i){},c469:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"main-container"},[e.showWebGL?t("div",[t("q-dialog",{attrs:{persistent:"",maximized:"","transition-show":"scale","transition-hide":"scale"},model:{value:e.showWebGL,callback:function(t){e.showWebGL=t},expression:"showWebGL"}},[t("q-card",[t("q-card-section",[t("div",{staticStyle:{display:"flex","justify-content":"space-between","align-items":"center"}},[t("div",{staticClass:"text-h6"}),t("q-btn",{attrs:{icon:"close",flat:"",round:"",dense:""},on:{click:e.toggleWebGL}})],1),t("div",{staticClass:"webgl-container"},[t("WebGLView")],1)])],1)],1)],1):t("div",[t("transition",{attrs:{name:"fade"}},[t("q-card",{staticStyle:{width:"650px","max-width":"100%"}},[t("q-card-section",[t("WebcamView")],1),t("q-card-actions",{attrs:{align:"center"}},[t("q-btn",{staticClass:"toggle-button",attrs:{label:"Open WebGL",color:"primary"},on:{click:e.toggleWebGL}})],1)],1)],1)],1)])},o=[],s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"webcam-container"},[t("video",{ref:"video",attrs:{autoplay:"",playsinline:""}})])},a=[],c={name:"WebcamView",data(){return{stream:null}},mounted(){this.startWebcam()},methods:{async startWebcam(){if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)try{const e=await navigator.mediaDevices.getUserMedia({video:!0});this.$refs.video.srcObject=e,this.stream=e}catch(e){console.error("Error accessing webcam: ",e)}else console.error("getUserMedia không được hỗ trợ trên trình duyệt của bạn!")},beforeDestroy(){if(this.stream){const e=this.stream.getTracks();e.forEach((e=>e.stop()))}}}},r=c,d=(i("d6ee"),i("2877")),l=Object(d["a"])(r,s,a,!1,null,"1f8b430b",null),h=l.exports,u=function(){var e=this,t=e._self._c;return t("div",{staticClass:"webgl-container"},[t("iframe",{staticStyle:{border:"0",width:"100%",height:"100vh"},attrs:{id:"unity-iframe",src:"/webgl/index.html"},on:{load:e.startStreaming}}),t("div",{staticClass:"video-section"},[t("div",{staticClass:"video-container"},[t("video",{ref:"videoStreamVideo",staticStyle:{width:"100%"},attrs:{autoplay:"",playsinline:"",muted:""},domProps:{muted:!0}}),t("p",{staticClass:"caption"},[e._v("Video Stream Video")])]),t("div",{staticClass:"video-container relative"},[t("video",{ref:"videoStreamVideo2",staticStyle:{width:"100%"},attrs:{autoplay:"",playsinline:"",muted:""},domProps:{muted:!0}}),t("video",{ref:"unityStreamVideo",staticStyle:{width:"100%"},attrs:{id:"unityStreamVideo",autoplay:"",playsinline:"",muted:""},domProps:{muted:!0}}),t("p",{staticClass:"caption"},[e._v("Unity Stream Video")])])])])},m=[],f=i("daa8"),v={name:"WebGLView",data(){return{unityPeerConnection:null,videoPeerConnection:null,socket:null}},mounted(){this.socket=Object(f["a"])("https://webrtcsvsocket.onrender.com",{withCredentials:!0,reconnection:!0}),this.socket.on("connect",(()=>{console.log("Connected to signaling server")})),this.socket.on("disconnect",(()=>{console.log("Disconnected from signaling server")})),this.initWebRTC()},methods:{initWebRTC(){this.unityPeerConnection=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),this.videoPeerConnection=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),this.socket.on("unity-offer",(async e=>{await this.unityPeerConnection.setRemoteDescription(new RTCSessionDescription(e));const t=await this.unityPeerConnection.createAnswer();await this.unityPeerConnection.setLocalDescription(t),this.socket.emit("unity-answer",t)})),this.socket.on("unity-answer",(async e=>{await this.unityPeerConnection.setRemoteDescription(new RTCSessionDescription(e))})),this.socket.on("unity-candidate",(e=>{this.unityPeerConnection.addIceCandidate(new RTCIceCandidate(e))})),this.unityPeerConnection.onicecandidate=e=>{e.candidate&&this.socket.emit("unity-candidate",e.candidate)},this.socket.on("video-offer",(async e=>{await this.videoPeerConnection.setRemoteDescription(new RTCSessionDescription(e));const t=await this.videoPeerConnection.createAnswer();await this.videoPeerConnection.setLocalDescription(t),this.socket.emit("video-answer",t)})),this.socket.on("video-answer",(async e=>{await this.videoPeerConnection.setRemoteDescription(new RTCSessionDescription(e))})),this.socket.on("video-candidate",(e=>{this.videoPeerConnection.addIceCandidate(new RTCIceCandidate(e))})),this.videoPeerConnection.onicecandidate=e=>{e.candidate&&this.socket.emit("video-candidate",e.candidate)}},startStreaming(){const e=document.getElementById("unity-iframe");try{const t=e.contentWindow.document.getElementById("unity-canvas");if(t){const e=t.captureStream(120);console.log(e);const i=this.$refs.unityStreamVideo;i.srcObject=e,i.onloadedmetadata=function(){i.play()},e.getTracks().forEach((t=>{this.unityPeerConnection.addTrack(t,e)})),this.unityPeerConnection.createOffer().then((e=>this.unityPeerConnection.setLocalDescription(e))).then((()=>{this.socket.emit("unity-offer",this.unityPeerConnection.localDescription)})).catch((e=>{console.error("Error creating or sending Unity offer",e)})),console.log("Unity stream started")}else console.error("Canvas not found inside iframe.")}catch(t){console.error("Error accessing canvas inside iframe:",t)}try{const t=e.contentWindow.document.getElementById("video-canvas");if(t){const e=t.captureStream(120),i=this.$refs.videoStreamVideo,n=this.$refs.videoStreamVideo2;i.srcObject=e,n.srcObject=e,e.getTracks().forEach((t=>{this.videoPeerConnection.addTrack(t,e)})),this.videoPeerConnection.createOffer().then((e=>this.videoPeerConnection.setLocalDescription(e))).then((()=>{this.socket.emit("video-offer",this.videoPeerConnection.localDescription)})).catch((e=>{console.error("Error creating or sending Video offer",e)}))}else console.error("Canvas not found inside iframe.")}catch(t){console.error("Error accessing canvas inside iframe:",t)}}}},w=v,C=(i("50a9"),Object(d["a"])(w,u,m,!1,null,"9582f31c",null)),y=C.exports,g=i("9c40"),p=i("24e8"),b=i("f09f"),P=i("a370"),k={name:"MainView",components:{WebcamView:h,WebGLView:y,QBtn:g["a"],QDialog:p["a"],QCard:b["a"],QCardSection:P["a"]},data(){return{showWebGL:!1}},methods:{toggleWebGL(){this.showWebGL=!this.showWebGL}}},S=k,W=(i("fc0f"),i("4b7e")),D=i("eebe"),L=i.n(D),V=Object(d["a"])(S,n,o,!1,null,"1001888c",null);t["default"]=V.exports;L()(V,"components",{QCard:b["a"],QCardSection:P["a"],QCardActions:W["a"],QBtn:g["a"],QDialog:p["a"]})},d6ee:function(e,t,i){"use strict";i("598e")},e286:function(e,t,i){},fc0f:function(e,t,i){"use strict";i("e286")}}]);